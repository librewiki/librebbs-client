(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["topic"],{"0cb2":function(t,e,i){"use strict";var s=i("e330"),a=i("7b0b"),o=Math.floor,n=s("".charAt),c=s("".replace),r=s("".slice),d=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;t.exports=function(t,e,i,s,m,u){var p=i+t.length,h=s.length,b=l;return void 0!==m&&(m=a(m),b=d),c(u,b,(function(a,c){var d;switch(n(c,0)){case"$":return"$";case"&":return t;case"`":return r(e,0,i);case"'":return r(e,p);case"<":d=m[r(c,1,-1)];break;default:var l=+c;if(0===l)return a;if(l>h){var u=o(l/10);return 0===u?a:u<=h?void 0===s[u-1]?n(c,1):s[u-1]+n(c,1):a}d=s[l-1]}return void 0===d?"":d}))}},3213:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"page-topic"},[e("div",{staticClass:"topic box level"},[e("router-link",{attrs:{to:`/${t.board.name}/${t.topic.id}`}},[e("h3",{staticClass:"title topic-title"},[t._v(t._s(t.decodeTitle(t.topic.title)))])]),t.user.isAdmin?e("b-dropdown",{staticClass:"admin-tools is-right"},[e("button",{staticClass:"button is-small",attrs:{slot:"trigger"},slot:"trigger"},[t._v("관리자 메뉴")]),t.topic.is_hidden?e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.unhide}},[t._v("숨김 해제")]):e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.hide}},[t._v("숨기기")]),t.topic.is_suspended?e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.unsuspend}},[t._v("잠금 해제")]):e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.suspend}},[t._v("잠그기")]),t.topic.is_closed?e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.unclose}},[t._v("종료 취소")]):e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.close}},[t._v("종료")]),t.topic.is_pinned?e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.unpin}},[t._v("상단 고정 해제")]):e("b-dropdown-item",{staticClass:"admin-button",on:{click:t.pin}},[t._v("상단 고정")])],1):t._e()],1),t._l(t.comments,(function(i,s){return e("topic-comment-card",{key:i.id,staticClass:"topic-content-card",attrs:{comment:t.comments[s]},on:{"update:comment":function(e){return t.$set(t.comments,s,e)}}})})),e("infinite-loading",{attrs:{spinner:"waveDots",identifier:t.infiniteId},on:{infinite:t.handleInfinite}},[e("div",{attrs:{slot:"no-more"},slot:"no-more"}),e("div",{attrs:{slot:"no-results"},slot:"no-results"})]),e("hr"),t.topic.is_closed?e("p",[t._v("이 주제는 종료되어 의견을 추가할 수 없습니다.")]):t.topic.is_suspended?e("p",[t._v("이 주제는 잠겨있어 의견을 추가할 수 없습니다.")]):t.user.isBlocked?e("p",[t._v("차단되어 있어 의견을 추가할 수 없습니다.")]):e("new-comment",{attrs:{"topic-id":t.topic.id,refresh:t.refresh}})],2)},a=[],o=i("ade3"),n=(i("14d9"),i("9ab4")),c=i("1b40"),r=i("e166"),d=i.n(r),l=i("7f5d"),m=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"card topic-comment-card"},[e("header",{staticClass:"card-header"},[e("div",{staticClass:"topic-comment-info"},[e("a",{attrs:{href:"https://librewiki.net/wiki/"+encodeURIComponent("사용자:"+t.comment.author_name)}},[e("div",{staticClass:"topic-comment-author"},[t._v(t._s(t.comment.author_name))])]),e("span",{staticClass:"comment-author-link"},[t._v("("),e("a",{attrs:{href:"https://librewiki.net/wiki/"+encodeURIComponent("사용자토론:"+t.comment.author_name)},on:{click:function(t){t.stopPropagation()}}},[t._v("토론")]),t._v("|"),e("a",{attrs:{href:"https://librewiki.net/wiki/"+encodeURIComponent("특수:기여/"+t.comment.author_name)},on:{click:function(t){t.stopPropagation()}}},[t._v("기여")]),t._v(")")])]),e("div",{staticClass:"topic-comment-tools"},[e("div",{staticClass:"topic-comment-date"},[t._v(t._s(t.dateString))]),e("b-dropdown",{staticClass:"is-right"},[e("button",{staticClass:"button is-small",attrs:{slot:"trigger"},slot:"trigger"},[e("b-icon",{attrs:{icon:"angle-down"}})],1),e("b-dropdown-item",{staticClass:"comment-tool-button",on:{click:t.quote}},[t._v("인용")]),t.user.isAdmin?[e("hr",{staticClass:"dropdown-divider"}),t.comment.is_hidden?[e("b-dropdown-item",{staticClass:"comment-tool-button",on:{click:t.unhide}},[t._v("숨기기 취소")]),e("b-dropdown-item",{staticClass:"comment-tool-button",on:{click:t.showHidden}},[t._v("내용 보기")])]:e("b-dropdown-item",{staticClass:"comment-tool-button",on:{click:t.hide}},[t._v("숨기기")]),e("b-dropdown-item",{staticClass:"comment-tool-button",attrs:{href:"https://librewiki.net/wiki/"+encodeURIComponent("특수:차단/"+t.comment.author_name)}},[t._v("사용자 차단")])]:t._e()],2)],1)]),e("div",{staticClass:"card-comment",class:{"hidden-comment":t.comment.is_hidden}},[t.comment.content?e("viewer",{attrs:{initialValue:t.comment.content}}):e("p",[t._v("이 의견은 관리자에 의해 숨겨졌습니다.")])],1)])},u=[],p=(i("5b81"),i("0613")),h=(i("fe5f"),i("4ede")),b=i("1315");let f=class extends c["c"]{constructor(...t){super(...t),Object(o["a"])(this,"comment",void 0)}get user(){return p["a"].state.user}get dateString(){return b["DateTime"].fromISO(this.comment.created_at).toLocaleString(b["DateTime"].DATETIME_MED)}async hide(){const t=await Object(l["h"])(this.comment.id);this.$emit("update:comment",t)}async unhide(){const t=await Object(l["p"])(this.comment.id);this.$emit("update:comment",t)}async showHidden(){const t=await Object(l["c"])(this.comment.id,!0);this.$emit("update:comment",t)}quote(){var t;console.log(this.comment.content);const e=null===(t=this.comment.content)||void 0===t?void 0:t.replaceAll("<br>","").replaceAll("\n","\n> "),i=`>${this.dateString}에 ${this.comment.author_name} 님이 작성:\n>${e}\n`;p["a"].commit("setEditorOpen",!0),p["a"].commit("setEditorInitialValue",i)}};Object(n["a"])([Object(c["b"])()],f.prototype,"comment",void 0),f=Object(n["a"])([Object(c["a"])({components:{Viewer:h["Viewer"]}})],f);var v=f,w=v,_=(i("cec8"),i("2877")),g=Object(_["a"])(w,m,u,!1,null,null,null),C=g.exports,O=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"modal",class:{"is-active":t.editorOpen}},[e("div",{staticClass:"modal-background"}),e("div",{staticClass:"modal-card"},[e("div",{staticClass:"modal-card-head"},[e("label",{staticClass:"modal-card-title",attrs:{id:"label_newtopic"}},[t._v("새 의견 추가하기")]),e("button",{staticClass:"delete",on:{click:t.modalclose}})]),e("div",{staticClass:"modal-card-body"},[e("div",{staticClass:"new-topic"},[e("div",{staticClass:"field"},[e("editor",{ref:"toastuiEditor",attrs:{options:t.editorOptions,initialEditType:"wysiwyg"}})],1)])]),e("div",{staticClass:"modal-card-foot"},[e("div",{staticClass:"field"},[t.user.isLoggedIn?t._e():e("span",[t._v("⚠️현재 로그인되어 있지 않습니다. 글 작성 시 IP가 노출됩니다.")]),e("div",{staticClass:"control"},[e("button",{staticClass:"button is-link",on:{click:t.handleSubmit}},[t._v("작성")])])])])])])},k=[];i("f513"),i("af52");let j=class extends c["c"]{constructor(...t){super(...t),Object(o["a"])(this,"topicId",void 0),Object(o["a"])(this,"refresh",void 0),Object(o["a"])(this,"editorOptions",{usageStatistics:!1,initialEditType:"wysiwyg",hideModeSwitch:!0,language:"ko-KR"}),Object(o["a"])(this,"$refs",void 0)}get user(){return p["a"].state.user}toBase64(t){return new Promise((e,i)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>e(s.result.split(",")[1]),s.onerror=t=>i(t)})}mounted(){this.$refs.toastuiEditor.invoke("addHook","addImageBlobHook",async(t,e)=>{if(t.size>1e7)p["a"].commit("setErrormodal","업로드할 파일 용량은 10MB까지만 가능합니다.");else{const{path:i}=await Object(l["l"])(t.name,await this.toBase64(t));e("https://image.librewiki.net/"+i)}})}async handleSubmit(){const t=this.$refs.toastuiEditor.invoke("getMarkdown");await Object(l["k"])(this.topicId,t),localStorage.setItem("topic-last-visited."+this.topicId,(new Date).toISOString()),this.$refs.toastuiEditor.invoke("reset"),this.refresh(),this.modalclose()}get editorOpen(){return p["a"].state.editor.open}onInitialValueChange(){this.$refs.toastuiEditor.invoke("setMarkdown",p["a"].state.editor.initialValue)}modalclose(){p["a"].commit("setEditorOpen",!1)}};Object(n["a"])([Object(c["b"])()],j.prototype,"topicId",void 0),Object(n["a"])([Object(c["b"])()],j.prototype,"refresh",void 0),Object(n["a"])([Object(c["d"])("$store.state.editor.initialValue")],j.prototype,"onInitialValueChange",null),j=Object(n["a"])([Object(c["a"])({components:{Editor:h["Editor"]}})],j);var y=j,I=y,$=(i("5ab2"),Object(_["a"])(I,O,k,!1,null,null,null)),x=$.exports,E=i("8731");let D=class extends c["c"]{constructor(...t){super(...t),Object(o["a"])(this,"topic",{id:0,board_id:0,title:"",is_closed:!1,is_suspended:!1,is_hidden:!1,is_pinned:!1,author_id:0,author_name:"",comment_count:0,created_at:"",updated_at:""}),Object(o["a"])(this,"comments",[]),Object(o["a"])(this,"busy",!1),Object(o["a"])(this,"infiniteId",+new Date)}get user(){return p["a"].state.user}get board(){return p["a"].state.board}decodeTitle(t){return Object(E["a"])(t)}refresh(){this.infiniteId+=1}async refreshComment(t){const e=this.comments.indexOf(t),i=(await Object(l["d"])(this.topic.id,e,1))[0];this.$set(this.comments,e,i)}async handleInfinite(t){const e=20,i=parseInt(this.$route.params.topicId),s=await Object(l["d"])(i,this.comments.length,e);s.length&&this.comments.push(...s),s.length<e?(t.complete(),setTimeout(t.reset,1e4)):t.loaded()}async fetchData(){this.busy=!0;try{const t=parseInt(this.$route.params.topicId),e=await Object(l["e"])(t);this.topic=e,this.checkCanWrite(e),localStorage.setItem("topic-last-visited."+e.id,(new Date).toISOString())}catch(t){p["a"].commit("setError",t)}finally{this.busy=!1}}checkCanWrite(t){1==t.is_closed||1==t.is_suspended||1==t.is_hidden||1==p["a"].state.user.isBlocked?p["a"].commit("setCanWrite",!1):p["a"].commit("setCanWrite",!0)}async hide(){await Object(l["i"])(this.topic.id),this.$router.push("/"+this.board.name)}async unhide(){await Object(l["q"])(this.topic.id),await this.fetchData()}async suspend(){await Object(l["n"])(this.topic.id),await this.fetchData()}async unsuspend(){await Object(l["s"])(this.topic.id),await this.fetchData()}async close(){await Object(l["a"])(this.topic.id),await this.fetchData()}async unclose(){await Object(l["o"])(this.topic.id),await this.fetchData()}async pin(){await Object(l["j"])(this.topic.id),await this.fetchData()}async unpin(){await Object(l["r"])(this.topic.id),await this.fetchData()}};Object(n["a"])([Object(c["d"])("$route.params",{immediate:!0})],D.prototype,"fetchData",null),D=Object(n["a"])([Object(c["a"])({components:{TopicCommentCard:C,NewComment:x,InfiniteLoading:d.a},metaInfo(){const t=this.board.display_name,e=this.decodeTitle(this.topic.title);return{title:`${e} - ${t}`}}})],D);var S=D,T=S,A=(i("f9c6"),Object(_["a"])(T,s,a,!1,null,null,null));e["default"]=A.exports},"44e7":function(t,e,i){"use strict";var s=i("861d"),a=i("c6b6"),o=i("b622"),n=o("match");t.exports=function(t){var e;return s(t)&&(void 0!==(e=t[n])?!!e:"RegExp"===a(t))}},"5ab2":function(t,e,i){"use strict";i("c422")},"5b81":function(t,e,i){"use strict";var s=i("23e7"),a=i("c65b"),o=i("e330"),n=i("1d80"),c=i("1626"),r=i("7234"),d=i("44e7"),l=i("577e"),m=i("dc4a"),u=i("90d8"),p=i("0cb2"),h=i("b622"),b=i("c430"),f=h("replace"),v=TypeError,w=o("".indexOf),_=o("".replace),g=o("".slice),C=Math.max;s({target:"String",proto:!0},{replaceAll:function(t,e){var i,s,o,h,O,k,j,y,I,$,x=n(this),E=0,D="";if(!r(t)){if(i=d(t),i&&(s=l(n(u(t))),!~w(s,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(o=m(t,f),o)return a(o,t,x,e);if(b&&i)return _(l(x),t,e)}h=l(x),O=l(t),k=c(e),k||(e=l(e)),j=O.length,y=C(1,j),I=w(h,O);while(-1!==I)$=k?l(e(O,I,h)):p(O,h,I,[],void 0,e),D+=g(h,E,I)+$,E=I+j,I=I+y>h.length?-1:w(h,O,I+y);return E<h.length&&(D+=g(h,E)),D}})},"7ea5":function(t,e,i){},"90d8":function(t,e,i){"use strict";var s=i("c65b"),a=i("1a2d"),o=i("3a9b"),n=i("ad6d"),c=RegExp.prototype;t.exports=function(t){var e=t.flags;return void 0!==e||"flags"in c||a(t,"flags")||!o(c,t)?e:s(n,t)}},a915:function(t,e,i){},ad6d:function(t,e,i){"use strict";var s=i("825a");t.exports=function(){var t=s(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},c422:function(t,e,i){},cec8:function(t,e,i){"use strict";i("7ea5")},f9c6:function(t,e,i){"use strict";i("a915")},fe5f:function(t,e,i){}}]);
//# sourceMappingURL=topic.bc02e49f.js.map